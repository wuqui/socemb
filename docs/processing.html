---

title: Processing


keywords: fastai
sidebar: home_sidebar

summary: "This notebook contains the processing pipeline."
description: "This notebook contains the processing pipeline."
nb_path: "00_processing.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_processing.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Imports">Imports<a class="anchor-link" href="#Imports"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">socemb.collect_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">socemb.read_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">socemb.type_emb</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">socemb.clean_data</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">socemb.usage_freq</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Variables">Variables<a class="anchor-link" href="#Variables"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">METHOD</span> <span class="o">=</span> <span class="s1">&#39;subreddit&#39;</span>
<span class="n">SUBREDDIT</span> <span class="o">=</span> <span class="s1">&#39;askreddit&#39;</span>
<span class="n">YEARS</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2021</span><span class="p">)]</span>
<span class="n">LIMIT</span> <span class="o">=</span> <span class="mi">100_000</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YEAR</span> <span class="o">=</span> <span class="s1">&#39;2012&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CORPUS_DIR</span> <span class="o">=</span> <span class="s1">&#39;data/&#39;</span>
<span class="n">VECS_DIR</span> <span class="o">=</span> <span class="s1">&#39;data/vecs/&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Collect-data">Collect data<a class="anchor-link" href="#Collect-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">query_subr</span><span class="p">(</span><span class="s1">&#39;politics&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">get_results</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="mi">1_000_000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>  0%|          | 1001/1000000 [01:05&lt;15:36:52, 17.77it/s]/Users/quirin/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/psaw/PushshiftAPI.py:252: UserWarning: Not all PushShift shards are active. Query results may be incomplete
  warnings.warn(shards_down_message)
  1%|▏         | 14101/1000000 [16:01&lt;21:17:22, 12.86it/s]/Users/quirin/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/psaw/PushshiftAPI.py:192: UserWarning: Got non 200 code 502
  warnings.warn(&#34;Got non 200 code %s&#34; % response.status_code)
/Users/quirin/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/psaw/PushshiftAPI.py:180: UserWarning: Unable to connect to pushshift.io. Retrying after backoff.
  warnings.warn(&#34;Unable to connect to pushshift.io. Retrying after backoff.&#34;)
 24%|██▍       | 244700/1000000 [8:15:19&lt;25:28:53,  8.23it/s]
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;timed exec&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>

<span class="ansi-green-fg">~/promo/socemb/socemb/collect_data.py</span> in <span class="ansi-cyan-fg">get_results</span><span class="ansi-blue-fg">(gen, limit)</span>
<span class="ansi-green-intense-fg ansi-bold">     43</span> <span class="ansi-green-fg">def</span> get_results<span class="ansi-blue-fg">(</span>gen<span class="ansi-blue-fg">,</span> limit<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     44</span>     cache <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-fg">---&gt; 45</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">for</span> c <span class="ansi-green-fg">in</span> tqdm<span class="ansi-blue-fg">(</span>gen<span class="ansi-blue-fg">,</span> total<span class="ansi-blue-fg">=</span>limit<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     46</span>         cache<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>c<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     47</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>cache<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&gt;=</span> limit<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/tqdm/std.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1176</span> 
<span class="ansi-green-intense-fg ansi-bold">   1177</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1178</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">for</span> obj <span class="ansi-green-fg">in</span> iterable<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1179</span>                 <span class="ansi-green-fg">yield</span> obj
<span class="ansi-green-intense-fg ansi-bold">   1180</span>                 <span class="ansi-red-fg"># Update and possibly print the progressbar.</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/psaw/PushshiftAPI.py</span> in <span class="ansi-cyan-fg">_search</span><span class="ansi-blue-fg">(self, kind, stop_condition, return_batch, dataset, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    236</span>         endpoint <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#39;{dataset}/{kind}/search&#39;</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>dataset<span class="ansi-blue-fg">=</span>dataset<span class="ansi-blue-fg">,</span> kind<span class="ansi-blue-fg">=</span>kind<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    237</span>         url <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>base_url<span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>endpoint<span class="ansi-blue-fg">=</span>endpoint<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 238</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> response <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>_handle_paging<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    239</span>             <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">&#39;aggs&#39;</span> <span class="ansi-green-fg">in</span> response<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    240</span>                 <span class="ansi-green-fg">yield</span> response<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;aggs&#39;</span><span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/psaw/PushshiftAPI.py</span> in <span class="ansi-cyan-fg">_handle_paging</span><span class="ansi-blue-fg">(self, url)</span>
<span class="ansi-green-intense-fg ansi-bold">    213</span>             self<span class="ansi-blue-fg">.</span>_add_nec_args<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>payload<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    214</span> 
<span class="ansi-green-fg">--&gt; 215</span><span class="ansi-red-fg">             </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_get<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>payload<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    216</span>             <span class="ansi-green-fg">yield</span> data
<span class="ansi-green-intense-fg ansi-bold">    217</span>             <span class="ansi-green-fg">if</span> limit <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/psaw/PushshiftAPI.py</span> in <span class="ansi-cyan-fg">_get</span><span class="ansi-blue-fg">(self, url, payload)</span>
<span class="ansi-green-intense-fg ansi-bold">    182</span>             i<span class="ansi-blue-fg">+=</span><span class="ansi-cyan-fg">1</span>
<span class="ansi-green-intense-fg ansi-bold">    183</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 184</span><span class="ansi-red-fg">                 </span>response <span class="ansi-blue-fg">=</span> requests<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span>url<span class="ansi-blue-fg">,</span> params<span class="ansi-blue-fg">=</span>payload<span class="ansi-blue-fg">,</span> proxies<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>proxies<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    185</span>                 log<span class="ansi-blue-fg">.</span>info<span class="ansi-blue-fg">(</span>response<span class="ansi-blue-fg">.</span>url<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    186</span>                 log<span class="ansi-blue-fg">.</span>debug<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;Response status code: %s&#39;</span> <span class="ansi-blue-fg">%</span> response<span class="ansi-blue-fg">.</span>status_code<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/requests/api.py</span> in <span class="ansi-cyan-fg">get</span><span class="ansi-blue-fg">(url, params, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> 
<span class="ansi-green-intense-fg ansi-bold">     75</span>     kwargs<span class="ansi-blue-fg">.</span>setdefault<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;allow_redirects&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 76</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> request<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;get&#39;</span><span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">,</span> params<span class="ansi-blue-fg">=</span>params<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     77</span> 
<span class="ansi-green-intense-fg ansi-bold">     78</span> 

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/requests/api.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(method, url, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     59</span>     <span class="ansi-red-fg"># cases, and look like a memory leak in others.</span>
<span class="ansi-green-intense-fg ansi-bold">     60</span>     <span class="ansi-green-fg">with</span> sessions<span class="ansi-blue-fg">.</span>Session<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> session<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 61</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> session<span class="ansi-blue-fg">.</span>request<span class="ansi-blue-fg">(</span>method<span class="ansi-blue-fg">=</span>method<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">=</span>url<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     62</span> 
<span class="ansi-green-intense-fg ansi-bold">     63</span> 

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/requests/sessions.py</span> in <span class="ansi-cyan-fg">request</span><span class="ansi-blue-fg">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="ansi-green-intense-fg ansi-bold">    540</span>         }
<span class="ansi-green-intense-fg ansi-bold">    541</span>         send_kwargs<span class="ansi-blue-fg">.</span>update<span class="ansi-blue-fg">(</span>settings<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 542</span><span class="ansi-red-fg">         </span>resp <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>send<span class="ansi-blue-fg">(</span>prep<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>send_kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    543</span> 
<span class="ansi-green-intense-fg ansi-bold">    544</span>         <span class="ansi-green-fg">return</span> resp

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/requests/sessions.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    653</span> 
<span class="ansi-green-intense-fg ansi-bold">    654</span>         <span class="ansi-red-fg"># Send the request</span>
<span class="ansi-green-fg">--&gt; 655</span><span class="ansi-red-fg">         </span>r <span class="ansi-blue-fg">=</span> adapter<span class="ansi-blue-fg">.</span>send<span class="ansi-blue-fg">(</span>request<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    656</span> 
<span class="ansi-green-intense-fg ansi-bold">    657</span>         <span class="ansi-red-fg"># Total elapsed time of the request (approximately)</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/requests/adapters.py</span> in <span class="ansi-cyan-fg">send</span><span class="ansi-blue-fg">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="ansi-green-intense-fg ansi-bold">    437</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    438</span>             <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> chunked<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 439</span><span class="ansi-red-fg">                 resp = conn.urlopen(
</span><span class="ansi-green-intense-fg ansi-bold">    440</span>                     method<span class="ansi-blue-fg">=</span>request<span class="ansi-blue-fg">.</span>method<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    441</span>                     url<span class="ansi-blue-fg">=</span>url<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">urlopen</span><span class="ansi-blue-fg">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    697</span> 
<span class="ansi-green-intense-fg ansi-bold">    698</span>             <span class="ansi-red-fg"># Make the request on the httplib connection object.</span>
<span class="ansi-green-fg">--&gt; 699</span><span class="ansi-red-fg">             httplib_response = self._make_request(
</span><span class="ansi-green-intense-fg ansi-bold">    700</span>                 conn<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    701</span>                 method<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    443</span>                     <span class="ansi-red-fg"># Python 3 (including for exceptions like SystemExit).</span>
<span class="ansi-green-intense-fg ansi-bold">    444</span>                     <span class="ansi-red-fg"># Otherwise it looks like a bug in the code.</span>
<span class="ansi-green-fg">--&gt; 445</span><span class="ansi-red-fg">                     </span>six<span class="ansi-blue-fg">.</span>raise_from<span class="ansi-blue-fg">(</span>e<span class="ansi-blue-fg">,</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    446</span>         <span class="ansi-green-fg">except</span> <span class="ansi-blue-fg">(</span>SocketTimeout<span class="ansi-blue-fg">,</span> BaseSSLError<span class="ansi-blue-fg">,</span> SocketError<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    447</span>             self<span class="ansi-blue-fg">.</span>_raise_timeout<span class="ansi-blue-fg">(</span>err<span class="ansi-blue-fg">=</span>e<span class="ansi-blue-fg">,</span> url<span class="ansi-blue-fg">=</span>url<span class="ansi-blue-fg">,</span> timeout_value<span class="ansi-blue-fg">=</span>read_timeout<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/urllib3/packages/six.py</span> in <span class="ansi-cyan-fg">raise_from</span><span class="ansi-blue-fg">(value, from_value)</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/site-packages/urllib3/connectionpool.py</span> in <span class="ansi-cyan-fg">_make_request</span><span class="ansi-blue-fg">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    438</span>                 <span class="ansi-red-fg"># Python 3</span>
<span class="ansi-green-intense-fg ansi-bold">    439</span>                 <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 440</span><span class="ansi-red-fg">                     </span>httplib_response <span class="ansi-blue-fg">=</span> conn<span class="ansi-blue-fg">.</span>getresponse<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    441</span>                 <span class="ansi-green-fg">except</span> BaseException <span class="ansi-green-fg">as</span> e<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    442</span>                     <span class="ansi-red-fg"># Remove the TypeError from the exception chain in</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/http/client.py</span> in <span class="ansi-cyan-fg">getresponse</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1345</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1346</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1347</span><span class="ansi-red-fg">                 </span>response<span class="ansi-blue-fg">.</span>begin<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1348</span>             <span class="ansi-green-fg">except</span> ConnectionError<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1349</span>                 self<span class="ansi-blue-fg">.</span>close<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/http/client.py</span> in <span class="ansi-cyan-fg">begin</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    305</span>         <span class="ansi-red-fg"># read until we get a non-100 response</span>
<span class="ansi-green-intense-fg ansi-bold">    306</span>         <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 307</span><span class="ansi-red-fg">             </span>version<span class="ansi-blue-fg">,</span> status<span class="ansi-blue-fg">,</span> reason <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_read_status<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    308</span>             <span class="ansi-green-fg">if</span> status <span class="ansi-blue-fg">!=</span> CONTINUE<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    309</span>                 <span class="ansi-green-fg">break</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/http/client.py</span> in <span class="ansi-cyan-fg">_read_status</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    266</span> 
<span class="ansi-green-intense-fg ansi-bold">    267</span>     <span class="ansi-green-fg">def</span> _read_status<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 268</span><span class="ansi-red-fg">         </span>line <span class="ansi-blue-fg">=</span> str<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>fp<span class="ansi-blue-fg">.</span>readline<span class="ansi-blue-fg">(</span>_MAXLINE <span class="ansi-blue-fg">+</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;iso-8859-1&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>line<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&gt;</span> _MAXLINE<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span>             <span class="ansi-green-fg">raise</span> LineTooLong<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;status line&#34;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/socket.py</span> in <span class="ansi-cyan-fg">readinto</span><span class="ansi-blue-fg">(self, b)</span>
<span class="ansi-green-intense-fg ansi-bold">    667</span>         <span class="ansi-green-fg">while</span> <span class="ansi-green-fg">True</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    668</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 669</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sock<span class="ansi-blue-fg">.</span>recv_into<span class="ansi-blue-fg">(</span>b<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    670</span>             <span class="ansi-green-fg">except</span> timeout<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    671</span>                 self<span class="ansi-blue-fg">.</span>_timeout_occurred <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/ssl.py</span> in <span class="ansi-cyan-fg">recv_into</span><span class="ansi-blue-fg">(self, buffer, nbytes, flags)</span>
<span class="ansi-green-intense-fg ansi-bold">   1239</span>                   <span class="ansi-blue-fg">&#34;non-zero flags not allowed in calls to recv_into() on %s&#34;</span> <span class="ansi-blue-fg">%</span>
<span class="ansi-green-intense-fg ansi-bold">   1240</span>                   self.__class__)
<span class="ansi-green-fg">-&gt; 1241</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>nbytes<span class="ansi-blue-fg">,</span> buffer<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1242</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1243</span>             <span class="ansi-green-fg">return</span> super<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>recv_into<span class="ansi-blue-fg">(</span>buffer<span class="ansi-blue-fg">,</span> nbytes<span class="ansi-blue-fg">,</span> flags<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/opt/miniconda3/envs/socemb/lib/python3.8/ssl.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self, len, buffer)</span>
<span class="ansi-green-intense-fg ansi-bold">   1097</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1098</span>             <span class="ansi-green-fg">if</span> buffer <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1099</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sslobj<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">,</span> buffer<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1100</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1101</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_sslobj<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments</span> <span class="o">=</span> <span class="n">conv_results_to_df</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comm_subr_to_csv</span><span class="p">(</span><span class="n">comments</span><span class="p">,</span> <span class="s1">&#39;politics&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;2007&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Read-data">Read data<a class="anchor-link" href="#Read-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fpath</span> <span class="o">=</span> <span class="n">get_fpath_subr_yr</span><span class="p">(</span><span class="n">SUBREDDIT</span><span class="p">,</span> <span class="n">LIMIT</span><span class="p">,</span> <span class="n">YEAR</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments</span> <span class="o">=</span> <span class="n">read_comm_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 99999 entries, 0 to 99999
Data columns (total 4 columns):
 #   Column       Non-Null Count  Dtype         
---  ------       --------------  -----         
 0   body         99999 non-null  string        
 1   created_utc  99999 non-null  datetime64[ns]
 2   id           99999 non-null  string        
 3   subreddit    99999 non-null  string        
dtypes: datetime64[ns](1), string(3)
memory usage: 3.8 MB
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Train-type-embeddings">Train type embeddings<a class="anchor-link" href="#Train-type-embeddings"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="per-subreddit">per subreddit<a class="anchor-link" href="#per-subreddit"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">subreddit</span> <span class="o">=</span> <span class="s1">&#39;politics&#39;</span>
<span class="n">limit</span> <span class="o">=</span> <span class="mi">100_000</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">2021</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">subreddit</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;askaconservative&#39;</span><span class="p">,</span> <span class="s1">&#39;asklibertarians&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">get_fpath_subr_yr</span><span class="p">(</span><span class="n">subreddit</span><span class="p">,</span> <span class="mi">100_000</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
            <span class="n">comments</span> <span class="o">=</span> <span class="n">read_comm_csv</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="n">docs_clean</span> <span class="o">=</span> <span class="n">clean_docs</span><span class="p">(</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
            <span class="n">corpus</span> <span class="o">=</span> <span class="n">Corpus</span><span class="p">(</span><span class="n">docs_clean</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">train_emb</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
            <span class="n">wv</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">wv</span>
            <span class="n">wv</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">VECS_DIR</span><span class="si">}{</span><span class="n">subreddit</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">limit</span><span class="si">}</span><span class="s1">.wv&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">:</span><span class="se">\t</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs_clean</span><span class="p">)</span><span class="si">}</span><span class="s1"> docs&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">continue</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>data/subreddit/askaconservative/100000_2006.csv not found on disk
data/subreddit/askaconservative/100000_2007.csv is empty
data/subreddit/askaconservative/100000_2008.csv is empty
data/subreddit/askaconservative/100000_2009.csv is empty
data/subreddit/askaconservative/100000_2010.csv is empty
data/subreddit/askaconservative/100000_2011.csv is empty
2012:	1881 docs
2013:	4715 docs
2014:	13066 docs
2015:	11928 docs
2016:	11080 docs
2017:	27587 docs
2018:	37826 docs
2019:	70474 docs
2020:	67636 docs
data/subreddit/asklibertarians/100000_2006.csv not found on disk
data/subreddit/asklibertarians/100000_2007.csv is empty
data/subreddit/asklibertarians/100000_2008.csv is empty
data/subreddit/asklibertarians/100000_2009.csv is empty
data/subreddit/asklibertarians/100000_2010.csv is empty
data/subreddit/asklibertarians/100000_2011.csv is empty
data/subreddit/asklibertarians/100000_2012.csv is empty
2013:	482 docs
2014:	1257 docs
2015:	1851 docs
2016:	2741 docs
2017:	8392 docs
2018:	24504 docs
2019:	34298 docs
2020:	58181 docs
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="per-year">per year<a class="anchor-link" href="#per-year"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">YEAR</span> <span class="o">=</span> <span class="mi">2020</span>
<span class="n">LIMIT</span> <span class="o">=</span> <span class="mi">100_000</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fpaths</span> <span class="o">=</span> <span class="n">get_fpaths_yr</span><span class="p">(</span><span class="n">YEAR</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fpaths</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Path(&#39;data/subreddit/asklibertarians/100000_2020.csv&#39;),
 Path(&#39;data/subreddit/askaconservative/100000_2020.csv&#39;),
 Path(&#39;data/subreddit/politics/100_2020.csv&#39;),
 Path(&#39;data/subreddit/politics/1000_2020.csv&#39;),
 Path(&#39;data/subreddit/politics/10000_2020.csv&#39;),
 Path(&#39;data/subreddit/politics/100000_2020.csv&#39;),
 Path(&#39;data/subreddit/askreddit/100000_2020.csv&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">comments</span> <span class="o">=</span> <span class="n">read_comm_csvs</span><span class="p">(</span><span class="n">fpaths</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docs_clean</span> <span class="o">=</span> <span class="n">clean_docs</span><span class="p">(</span><span class="n">comments</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">docs_clean</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0         [you, re, asking, how, they, re, going, to, be...
1         [gt, i, don, t, think, there, are, any, varyin...
2         [its, split, on, copyright, it, leans, anti, n...
3         [that, would, be, up, to, the, land, owners, a...
4         [i, have, him, here, gun, to, his, head, round...
                                ...                        
380954    [the, nature, police, are, supposed, to, be, p...
380957    [i, got, reddit, last, year, and, only, starte...
380958    [i, m, just, curious, how, this, is, clear, to...
380962    [staying, at, said, job, while, being, underpa...
380963    [i, m, not, sure, that, this, has, ever, been,...
Name: body, Length: 264796, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">corpus</span> <span class="o">=</span> <span class="n">Corpus</span><span class="p">(</span><span class="n">docs_clean</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">train_emb</span><span class="p">(</span><span class="n">corpus</span><span class="p">)</span>
<span class="n">wv</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">wv</span>
<span class="n">wv</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">VECS_DIR</span><span class="si">}</span><span class="s1">year/</span><span class="si">{</span><span class="n">YEAR</span><span class="si">}</span><span class="s1">.wv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 2min 33s, sys: 841 ms, total: 2min 34s
Wall time: 41.6 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clean-data">Clean data<a class="anchor-link" href="#Clean-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Remove-bot-subreddits">Remove bot subreddits<a class="anchor-link" href="#Remove-bot-subreddits"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">rm_bots_subreddits</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Remove-duplicate-comments">Remove duplicate comments<a class="anchor-link" href="#Remove-duplicate-comments"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">rm_dupl_comments</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Remove-comments-without-target-tokens">Remove comments without target tokens<a class="anchor-link" href="#Remove-comments-without-target-tokens"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">rm_comm_no_toks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">LEX</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Usage-frequency">Usage frequency<a class="anchor-link" href="#Usage-frequency"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Aggregate-usage-frequency-in-monthly-bins">Aggregate usage frequency in monthly bins<a class="anchor-link" href="#Aggregate-usage-frequency-in-monthly-bins"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_m</span> <span class="o">=</span> <span class="n">get_monthly_freq</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df_m</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Plot-usage-frequency">Plot usage frequency<a class="anchor-link" href="#Plot-usage-frequency"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_use_freq</span><span class="p">(</span><span class="n">df_m</span><span class="p">,</span> <span class="n">LEX</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Export-notebooks">Export notebooks<a class="anchor-link" href="#Export-notebooks"> </a></h2>
</div>
</div>
</div>
</div>
 

